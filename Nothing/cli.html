<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Device CLI</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
</head>
<body>
    <h1>Device CLI</h1>
    <div class="hostname-display">
        <p>{{ hostname }}</p>
    </div>
    <div class="output-box" id="output-box">  <!-- เปลี่ยน ID เป็น class -->
        <pre id="output"></pre>
    </div>

    <div id="input-box">
        <input type="text" id="command" placeholder="Enter Command">
        <button onclick="sendCommand()">Send</button>
    </div>

    <script>
        const socket = io();
        let waitingForPassword = false;

        // ฟังก์ชันส่งคำสั่งไปยังเซิร์ฟเวอร์
        function sendCommand() {
            const command = document.getElementById('command').value;

            // ถ้ารอให้กรอกรหัสผ่าน
            if (waitingForPassword) {
                socket.emit('send_command', { command: command });  // ส่งรหัสผ่าน
            } else {
                socket.emit('send_command', { command: command });
            }
            
            document.getElementById('command').value = '';  // ล้างช่องใส่คำสั่ง
        }

        // รับผลลัพธ์จากอุปกรณ์และแสดงในหน้าเว็บ
        socket.on('cli_output', function (data) {
            const output = document.getElementById('output');
            output.textContent += data.output;
            output.scrollTop = output.scrollHeight;

            // ถ้าต้องการรหัสผ่าน
            if (data.output.includes('Password:')) {
                waitingForPassword = true;
                document.getElementById('command').placeholder = 'Enter Password';  // เปลี่ยน placeholder
            } else {
                waitingForPassword = false;
                document.getElementById('command').placeholder = 'Enter Command';  // เปลี่ยนกลับ
            }
        });

    </script>
    <form action="/back" method="POST">              
        <button type="submit" class="back-button">Back to Commands</button>
    </form>
</body>
</html>
